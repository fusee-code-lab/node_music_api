"use strict";var V=Object.create;var f=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var Z=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty;var te=(e,t)=>{for(var r in t)f(e,r,{get:t[r],enumerable:!0})},k=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Y(t))!ee.call(e,s)&&s!==r&&f(e,s,{get:()=>t[s],enumerable:!(o=X(t,s))||o.enumerable});return e};var re=(e,t,r)=>(r=e!=null?V(Z(e)):{},k(t||!e||!e.__esModule?f(r,"default",{value:e,enumerable:!0}):r,e)),se=e=>k(f({},"__esModule",{value:!0}),e);var ye={};te(ye,{ListResponsePack:()=>q,ResponsePack:()=>b,SearchResult:()=>x,netease:()=>le,qq:()=>ge,test:()=>pe});module.exports=se(ye);var N=re(require("NeteaseCloudMusicApi"));var O=require("NeteaseCloudMusicApi");var g=require("NeteaseCloudMusicApi");var ae=(e,t)=>!e||e.program?0:t?t.st!=null&&t.st<0?100:t.fee>0&&t.fee!=8&&t.payed==0&&t.pl<=0?10:t.fee==16||t.fee==4&&t.flag&2048?11:(t.fee==0||t.payed)&&t.pl>0&&t.dl==0?1e3:t.pl==0&&t.dl==0?100:0:e.status>=0?0:e.fee>0?10:100,ne=e=>e.st!=null&&e.st<0?100:e.fee>0&&e.fee!=8&&e.payed==0&&e.pl<=0?10:e.fee==16||e.fee==4&&e.flag&2048?11:(e.fee==0||e.payed)&&e.pl>0&&e.dl==0?1e3:e.pl==0&&e.dl==0?100:0,ie=(e,t)=>ae(e,t)===100||ne(t)===10,R=e=>({album:{id:e.al.id,name:e.al.name},artists:e.ar.map(r=>({id:r.id,name:r.name})),id:e.id,link:`https://music.163.com/#/song?id=${e.id}`,song_id:e.id,song_name:e.name,song_desc:e.al.name,song_time:e.dt/1e3,song_img_url:e.al.picUrl,cp:ie(e,e.privilege),dl:!e.privilege.fee,quality:{192:e.privilege.maxbr>=192e3,320:e.privilege.maxbr>=32e4,999:e.privilege.maxbr>=999e3},mv:e.mv||null}),S=e=>({album:{id:e.al.id,name:e.al.name},artists:e.ar.map(r=>({id:r.id,name:r.name})),id:e.id,link:`https://music.163.com/#/song?id=${e.id}`,song_id:e.id,song_name:e.name,song_desc:e.al.name,song_time:e.dt/1e3,song_img_url:e.al.picUrl,cp:e.cp,dl:!e.fee,quality:{192:e.m?.br>=192e3,320:e.h?.br>=32e4,999:e.sq?.br>=999e3},mv:e.mvid||null}),T=e=>{switch(e){case 1:return 1;case 2:return 10;case 3:return 100;case 4:return 1e3;case 5:return 1002;case 6:return 1004;case 7:return 1006;case 8:return 1009}},E=e=>{switch(e){case"standard":return g.SoundQualityType.standard;case"exhigh":return g.SoundQualityType.exhigh;case"lossless":return g.SoundQualityType.lossless;case"hires":return g.SoundQualityType.hires;case"jyeffect":return g.SoundQualityType.jyeffect;case"jymaster":return g.SoundQualityType.jymaster;case"sky":return g.SoundQualityType.sky}};var v=async(e,t,r,o)=>{let s=T(o);if(s==null)return;let n=await(0,O.cloudsearch)({keywords:e,limit:t,offset:r,type:s});if(n&&n.status===200&&n.body&&n.body.code===200&&n.body.result){switch(o){case 1:let a=n.body.result.songs;a&&(n.body.result.songs=a.map(u=>R(u)));break}return n.body.result}};var P=require("NeteaseCloudMusicApi");var j=async(e,t)=>{let r=await(0,P.song_url_v1)({id:e.join(","),level:E(t)||"exhigh"}).catch(o=>(console.error(o),null));if(r&&r.status===200&&r.body.code===200){let o={};return r.body.data.forEach(s=>{o[s.id]=s.url}),o}};var I=require("NeteaseCloudMusicApi");var U=async e=>{let t=await(0,I.playlist_detail)({id:e}).catch(r=>(console.error(r),null));if(t&&t.status===200&&t.body.code===200)return t.body.playlist.tracks=t.body.playlist.tracks.map(S),t.body.playlist};var A=require("NeteaseCloudMusicApi");var z=()=>{let e=["Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/603.2.4 (KHTML, like Gecko) Version/10.1.1 Safari/603.2.4","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:46.0) Gecko/20100101 Firefox/46.0","Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:46.0) Gecko/20100101 Firefox/46.0","Mozilla/5.0 (Windows NT 6.3; Win64, x64; Trident/7.0; rv:11.0) like Gecko","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36 Edge/13.10586"];return e[Math.floor(Math.random()*e.length-1)]},y=(e,t=!1)=>{if(!e)return t?{lyric:[],translate:[]}:[];let r=e.replace(/\<\d+\>/g,"").split(`
`),o=[],s=[];return r.forEach((n,a)=>{let u=n.match(/((\[\d+:\d+\.\d+\])+)(.*)/);if(u&&u[1]){let l=u[1].match(/\[\d+:\d+\.\d+\]/g);if(!l)return;l.forEach(c=>{if(o.push([c.substring(1,c.length-1),u[3]]),t&&r[a+1]){let _=r[a+1].match(/(\[x\-trans\])(.*)/);_&&_[2]?s.push([c.substring(1,c.length-1),_[2]]):s.push([c.substring(1,c.length-1),""])}else s.push([c.substring(1,c.length-1),""])})}}),t&&s.filter(n=>n[1]).length===0&&(s=[]),t?{lyric:o.sort(),translate:s.sort()}:o.sort()};var M=async e=>{let t=await(0,A.lyric)({id:e}).catch(r=>(console.error(r),null));try{if(t&&t.status===200&&t.body.code===200&&t.body.lrc&&t.body.lrc.lyric){let r=y(t.body.lrc.lyric)||[],o=[];for(let s=0;s<r.length-1;s++)r[s][1]!==r[s+1][1]&&o.push(r[s]);return r.length&&o.push(r.pop()),{lyric:y(t.body.lrc.lyric),translate:o}}}catch(r){console.error(r)}};var le={...N.default,search:v,song_url:j,song_list:U,lyric:M};var D=require("fs"),G=require("path");var ce=e=>{let t=[];for(let r in e){let o=e[r];["",void 0,null].includes(o)||(o.constructor===Array?o.forEach(s=>{t.push(encodeURIComponent(r)+"[]="+encodeURIComponent(s))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(o)))}return t.length?t.join("&"):""},ue=(e,t={})=>{t.method??="GET",t.timeout??=1e3*60,t.type??="JSON",t.headers??={"content-type":"application/json;charset=utf-8"},t.data&&t.method==="GET"&&(e+=`?${ce(t.data)}`);let r=t.controller??new AbortController,o=setTimeout(()=>r.abort(),t.timeout);return fetch(e,{...t,signal:r.signal}).then(async s=>{clearTimeout(o);let n;switch(t.type){case"BUFFER":n=await s.arrayBuffer().catch(a=>{throw a});break;case"JSON":n=await s.json().catch(a=>{throw a});break;case"TEXT":n=await s.text().catch(a=>{throw a});break;default:n=await s.arrayBuffer().catch(a=>{throw a});break}return{data:n,headers:s.headers}}).catch(s=>(clearTimeout(o),{error:s}))};var W=ue;var m={},L=e=>{e.split("; ").forEach(t=>{let r=t.split("=");m[r[0]]=r[1]}),Number(m.login_type)===2&&(m.uin=m.wxuin),m.uin=(m.uin||"").replace(/\D/g,"")},de=e=>m[e],me=()=>Object.keys(m).map(e=>`${e}=${encodeURI(m[e])}`).join("; ");var h=(e,t=de("uin"))=>({search:{req_1:{method:"DoSearchForQQMusicDesktop",module:"music.search.SearchCgiService",param:{uin:t,search_type:0,query:"",page_num:0,num_per_page:0}}},getVkey:{req_1:{module:"vkey.GetVkeyServer",method:"CgiGetVkey",param:{guid:"",songmid:[],songtype:[0],uin:t,loginflag:1,platform:"20"}}},getPlaylist:{req_1:{module:"music.srfDissInfo.aiDissInfo",method:"uniform_get_Dissinfo",param:{format:"json",type:1,utf8:1,disstid:"",loginUin:t}}}})[e];var $=e=>{let t={album:{id:e.album.id,mid:e.album.mid,name:e.album.name},artists:e.singer.map(r=>({id:r.id,name:r.name})),id:e.mid,link:`https://y.qq.com/n/yqq/song/${e.mid}.html`,song_id:e.id,song_name:e.title,song_desc:e.desc,song_time:e.interval,cp:e.action.msg===3||!e.interval,dl:!e.pay.pay_down,quality:{192:!!(e.file.size_aac||e.file.size_192aac||e.file.size_ogg||e.file.size_192ogg),320:!!(e.file.size_320||e.file.size_320mp3),999:!!e.file.size_flac},mv:e.mv.vid||null};return t.album.mid?t.song_img_url=`https://y.gtimg.cn/music/photo_new/T002R300x300M000${t.album.mid}.jpg`:e.vs&&e.vs[1]&&(t.song_img_url=`https://y.gtimg.cn/music/photo_new/T062R300x300M000${e.vs[1]}.jpg`),t},C=e=>{let t={album:{id:e.albumid,mid:e.albummid,name:e.albumname},artists:e.singer.map(r=>({id:r.id,name:r.name})),id:e.songmid,link:`https://y.qq.com/n/yqq/song/${e.songmid}.html`,song_id:e.songid,song_name:e.songname,song_desc:e.albumdesc,song_time:e.interval,cp:e.msgid===3||!e.interval,dl:!e.pay.paydownload,quality:{192:!!e.sizeogg,320:!!e.size320,999:!!e.sizeflac},mv:e.vid||null};return t.album.mid&&(t.song_img_url=`https://y.gtimg.cn/music/photo_new/T002R300x300M000${t.album.mid}.jpg`),t},J=e=>{switch(e){case 1:return 0;case 2:return 2;case 3:return 8;case 4:return 3;case 5:return 8;case 6:return 4;case 7:return 7;case 8:return null}},d={m4a:{s:"C400",e:"m4a"},128:{s:"M500",e:"mp3"},320:{s:"M800",e:"mp3"},ape:{s:"A000",e:"ape"},flac:{s:"F000",e:"flac"}},Q=e=>{switch(e){case"standard":return d[128];case"exhigh":return d[320];case"lossless":return d[320];case"hires":return d.flac;case"jyeffect":return d.flac;case"jymaster":return d.flac;case"sky":return d.flac}},p=(e={},t="https://u.y.qq.com/cgi-bin/musicu.fcg")=>(e.headers=Object.assign({Referer:"https://y.qq.com",Cookie:me(),"User-Agent":z()},e.headers),W(t,e));var H=async(e,t,r,o)=>{let s=J(o);if(s===null)return;let n=h("search");n.req_1.param.query=e,n.req_1.param.page_num=r,n.req_1.param.num_per_page=t,n.req_1.param.search_type=s;let a=await p({body:JSON.stringify(n),method:"POST",type:"JSON"});if(a&&a.data&&a.data.code===0&&a.data.req_1.code===0&&a.data.req_1.data){let u=a.data.req_1.data.meta.sum,l=[];switch(s){case 0:case 7:l=a.data.req_1.data.body.song.list.map(c=>$(c));break;case 2:l=a.data.req_1.data.body.album.list;break;case 3:l=a.data.req_1.data.body.songlist.list;break;case 4:l=a.data.req_1.data.body.mv.list;break;case 8:l=a.data.req_1.data.body.user.list;break;default:return a.data.req_1.data.body}return{count:u,list:l}}};var K=async(e,t)=>{let r=(Math.random()*1e7).toFixed(0);if(!(Q(t)||d[320])){console.error("\u4E0D\u652F\u6301\u7684\u97F3\u8D28\u7C7B\u578B: "+t);return}let s=h("getVkey");s.req_1.param.guid=r,s.req_1.param.songmid.push(...e);let n=await p({body:JSON.stringify(s),method:"POST",type:"JSON"});try{let a=n.data?.req_1.data.sip.find(l=>!l.startsWith("http://ws"))||n.data?.req_1.data.sip[0],u={};return n.data?.req_1.data.midurlinfo.filter(l=>!!l.purl).forEach(l=>{let c=l.songmid,_=l.purl;u[c]=a+_}),u}catch(a){console.error(a)}};var B=async e=>{let t=h("getPlaylist");t.req_1.param.disstid=e;let r=await p({data:t.req_1.param,method:"GET",headers:{Referer:"https://y.qq.com/n/yqq/playlist"},type:"JSON"},"https://i.y.qq.com/qzone-music/fcg-bin/fcg_ucc_getcdinfo_byids_cp.fcg");try{if(r&&r.data.code===0)return r.data.cdlist.forEach(o=>{o.songlist=o.songlist.map(C)}),r.data.cdlist[0]}catch(o){console.error(o)}};var F=async e=>{let t=await p({data:{songmid:e,g_tk:5381,format:"json",inCharset:"utf8",outCharset:"utf-8",nobase64:1},method:"GET",type:"JSON"},"https://i.y.qq.com/lyric/fcgi-bin/fcg_query_lyric_new.fcg");try{return{lyric:y(t.data.lyric),translate:y(t.data.trans)}}catch(r){console.error(r)}};var ge={search:H,song_url:K,song_list:B,set_cookie:L,lyric:F};var pe=()=>{};var b=class{constructor(t,r,o){this.status=t;this.rawBody=r;this.data=o}},q=class{constructor(t,r,o){this.status=t;this.rawBody=r;this.data=o}};var x=class e{constructor(t,r,o={limit:e.DEFAULT_LIMIT,offset:0}){this.searchOptions=t;this.fetchFunc=r;this.position=o}static DEFAULT_LIMIT=20;limit(t){return this.position.limit=t,this}offset(t){return this.position.offset=t,this}async nextPage(){let t=await this.fetchFunc(this.searchOptions,this.position);return this.position.offset+=this.position.limit,t}};0&&(module.exports={ListResponsePack,ResponsePack,SearchResult,netease,qq,test});
