import V from"NeteaseCloudMusicApi";import{cloudsearch as H}from"NeteaseCloudMusicApi";import{SoundQualityType as y}from"NeteaseCloudMusicApi";var C=(e,t)=>!e||e.program?0:t?t.st!=null&&t.st<0?100:t.fee>0&&t.fee!=8&&t.payed==0&&t.pl<=0?10:t.fee==16||t.fee==4&&t.flag&2048?11:(t.fee==0||t.payed)&&t.pl>0&&t.dl==0?1e3:t.pl==0&&t.dl==0?100:0:e.status>=0?0:e.fee>0?10:100,J=e=>e.st!=null&&e.st<0?100:e.fee>0&&e.fee!=8&&e.payed==0&&e.pl<=0?10:e.fee==16||e.fee==4&&e.flag&2048?11:(e.fee==0||e.payed)&&e.pl>0&&e.dl==0?1e3:e.pl==0&&e.dl==0?100:0,Q=(e,t)=>C(e,t)===100||J(t)===10,q=e=>({album:{id:e.al.id,name:e.al.name},artists:e.ar.map(r=>({id:r.id,name:r.name})),id:e.id,link:`https://music.163.com/#/song?id=${e.id}`,song_id:e.id,song_name:e.name,song_desc:e.al.name,song_time:e.dt/1e3,song_img_url:e.al.picUrl,cp:Q(e,e.privilege),dl:!e.privilege.fee,quality:{192:e.privilege.maxbr>=192e3,320:e.privilege.maxbr>=32e4,999:e.privilege.maxbr>=999e3},mv:e.mv||null}),x=e=>({album:{id:e.al.id,name:e.al.name},artists:e.ar.map(r=>({id:r.id,name:r.name})),id:e.id,link:`https://music.163.com/#/song?id=${e.id}`,song_id:e.id,song_name:e.name,song_desc:e.al.name,song_time:e.dt/1e3,song_img_url:e.al.picUrl,cp:e.cp,dl:!e.fee,quality:{192:e.m?.br>=192e3,320:e.h?.br>=32e4,999:e.sq?.br>=999e3},mv:e.mvid||null}),k=e=>{switch(e){case 1:return 1;case 2:return 10;case 3:return 100;case 4:return 1e3;case 5:return 1002;case 6:return 1004;case 7:return 1006;case 8:return 1009}},w=e=>{switch(e){case"standard":return y.standard;case"exhigh":return y.exhigh;case"lossless":return y.lossless;case"hires":return y.hires;case"jyeffect":return y.jyeffect;case"jymaster":return y.jymaster;case"sky":return y.sky}};var R=async(e,t,r,o)=>{let s=k(o);if(s==null)return;let n=await H({keywords:e,limit:t,offset:r,type:s});if(n&&n.status===200&&n.body&&n.body.code===200&&n.body.result){switch(o){case 1:let a=n.body.result.songs;a&&(n.body.result.songs=a.map(d=>q(d)));break}return n.body.result}};import{song_url_v1 as K}from"NeteaseCloudMusicApi";var S=async(e,t)=>{let r=await K({id:e.join(","),level:w(t)||"exhigh"}).catch(o=>(console.error(o),null));if(r&&r.status===200&&r.body.code===200){let o={};return r.body.data.forEach(s=>{o[s.id]=s.url}),o}};import{playlist_detail as B}from"NeteaseCloudMusicApi";var T=async e=>{let t=await B({id:e}).catch(r=>(console.error(r),null));if(t&&t.status===200&&t.body.code===200)return t.body.playlist.tracks=t.body.playlist.tracks.map(x),t.body.playlist};import{lyric as F}from"NeteaseCloudMusicApi";var E=()=>{let e=["Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/603.2.4 (KHTML, like Gecko) Version/10.1.1 Safari/603.2.4","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:46.0) Gecko/20100101 Firefox/46.0","Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:46.0) Gecko/20100101 Firefox/46.0","Mozilla/5.0 (Windows NT 6.3; Win64, x64; Trident/7.0; rv:11.0) like Gecko","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36 Edge/13.10586"];return e[Math.floor(Math.random()*e.length-1)]},h=(e,t=!1)=>{if(!e)return t?{lyric:[],translate:[]}:[];let r=e.replace(/\<\d+\>/g,"").split(`
`),o=[],s=[];return r.forEach((n,a)=>{let d=n.match(/((\[\d+:\d+\.\d+\])+)(.*)/);if(d&&d[1]){let c=d[1].match(/\[\d+:\d+\.\d+\]/g);if(!c)return;c.forEach(u=>{if(o.push([u.substring(1,u.length-1),d[3]]),t&&r[a+1]){let f=r[a+1].match(/(\[x\-trans\])(.*)/);f&&f[2]?s.push([u.substring(1,u.length-1),f[2]]):s.push([u.substring(1,u.length-1),""])}else s.push([u.substring(1,u.length-1),""])})}}),t&&s.filter(n=>n[1]).length===0&&(s=[]),t?{lyric:o.sort(),translate:s.sort()}:o.sort()};var O=async e=>{let t=await F({id:e}).catch(r=>(console.error(r),null));try{if(t&&t.status===200&&t.body.code===200&&t.body.lrc&&t.body.lrc.lyric){let r=h(t.body.lrc.lyric)||[],o=[];for(let s=0;s<r.length-1;s++)r[s][1]!==r[s+1][1]&&o.push(r[s]);return r.length&&o.push(r.pop()),{lyric:h(t.body.lrc.lyric),translate:o}}}catch(r){console.error(r)}};var Ue={...V,search:R,song_url:S,song_list:T,lyric:O};var X=e=>{let t=[];for(let r in e){let o=e[r];["",void 0,null].includes(o)||(o.constructor===Array?o.forEach(s=>{t.push(encodeURIComponent(r)+"[]="+encodeURIComponent(s))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(o)))}return t.length?t.join("&"):""},Y=(e,t={})=>{t.method??="GET",t.timeout??=1e3*60,t.type??="JSON",t.headers??={"content-type":"application/json;charset=utf-8"},t.data&&t.method==="GET"&&(e+=`?${X(t.data)}`);let r=t.controller??new AbortController,o=setTimeout(()=>r.abort(),t.timeout);return fetch(e,{...t,signal:r.signal}).then(async s=>{clearTimeout(o);let n;switch(t.type){case"BUFFER":n=await s.arrayBuffer().catch(a=>{throw a});break;case"JSON":n=await s.json().catch(a=>{throw a});break;case"TEXT":n=await s.text().catch(a=>{throw a});break;default:n=await s.arrayBuffer().catch(a=>{throw a});break}return{data:n,headers:s.headers}}).catch(s=>(clearTimeout(o),{error:s}))};var v=Y;var g={},P=e=>{e.split("; ").forEach(t=>{let r=t.split("=");g[r[0]]=r[1]}),Number(g.login_type)===2&&(g.uin=g.wxuin),g.uin=(g.uin||"").replace(/\D/g,"")},Z=e=>g[e],ee=()=>Object.keys(g).map(e=>`${e}=${encodeURI(g[e])}`).join("; ");var _=(e,t=Z("uin"))=>({search:{req_1:{method:"DoSearchForQQMusicDesktop",module:"music.search.SearchCgiService",param:{uin:t,search_type:0,query:"",page_num:0,num_per_page:0}}},getVkey:{req_1:{module:"vkey.GetVkeyServer",method:"CgiGetVkey",param:{guid:"",songmid:[],songtype:[0],uin:t,loginflag:1,platform:"20"}}},getPlaylist:{req_1:{module:"music.srfDissInfo.aiDissInfo",method:"uniform_get_Dissinfo",param:{format:"json",type:1,utf8:1,disstid:"",loginUin:t}}}})[e];var j=e=>{let t={album:{id:e.album.id,mid:e.album.mid,name:e.album.name},artists:e.singer.map(r=>({id:r.id,name:r.name})),id:e.mid,link:`https://y.qq.com/n/yqq/song/${e.mid}.html`,song_id:e.id,song_name:e.title,song_desc:e.desc,song_time:e.interval,cp:e.action.msg===3||!e.interval,dl:!e.pay.pay_down,quality:{192:!!(e.file.size_aac||e.file.size_192aac||e.file.size_ogg||e.file.size_192ogg),320:!!(e.file.size_320||e.file.size_320mp3),999:!!e.file.size_flac},mv:e.mv.vid||null};return t.album.mid?t.song_img_url=`https://y.gtimg.cn/music/photo_new/T002R300x300M000${t.album.mid}.jpg`:e.vs&&e.vs[1]&&(t.song_img_url=`https://y.gtimg.cn/music/photo_new/T062R300x300M000${e.vs[1]}.jpg`),t},I=e=>{let t={album:{id:e.albumid,mid:e.albummid,name:e.albumname},artists:e.singer.map(r=>({id:r.id,name:r.name})),id:e.songmid,link:`https://y.qq.com/n/yqq/song/${e.songmid}.html`,song_id:e.songid,song_name:e.songname,song_desc:e.albumdesc,song_time:e.interval,cp:e.msgid===3||!e.interval,dl:!e.pay.paydownload,quality:{192:!!e.sizeogg,320:!!e.size320,999:!!e.sizeflac},mv:e.vid||null};return t.album.mid&&(t.song_img_url=`https://y.gtimg.cn/music/photo_new/T002R300x300M000${t.album.mid}.jpg`),t},U=e=>{switch(e){case 1:return 0;case 2:return 2;case 3:return 8;case 4:return 3;case 5:return 8;case 6:return 4;case 7:return 7;case 8:return null}},m={m4a:{s:"C400",e:"m4a"},128:{s:"M500",e:"mp3"},320:{s:"M800",e:"mp3"},ape:{s:"A000",e:"ape"},flac:{s:"F000",e:"flac"}},z=e=>{switch(e){case"standard":return m[128];case"exhigh":return m[320];case"lossless":return m[320];case"hires":return m.flac;case"jyeffect":return m.flac;case"jymaster":return m.flac;case"sky":return m.flac}},p=(e={},t="https://u.y.qq.com/cgi-bin/musicu.fcg")=>(e.headers=Object.assign({Referer:"https://y.qq.com",Cookie:ee(),"User-Agent":E()},e.headers),v(t,e));var A=async(e,t,r,o)=>{let s=U(o);if(s===null)return;let n=_("search");n.req_1.param.query=e,n.req_1.param.page_num=r,n.req_1.param.num_per_page=t,n.req_1.param.search_type=s;let a=await p({body:JSON.stringify(n),method:"POST",type:"JSON"});if(a&&a.data&&a.data.code===0&&a.data.req_1.code===0&&a.data.req_1.data){let d=a.data.req_1.data.meta.sum,c=[];switch(s){case 0:case 7:c=a.data.req_1.data.body.song.list.map(u=>j(u));break;case 2:c=a.data.req_1.data.body.album.list;break;case 3:c=a.data.req_1.data.body.songlist.list;break;case 4:c=a.data.req_1.data.body.mv.list;break;case 8:c=a.data.req_1.data.body.user.list;break;default:return a.data.req_1.data.body}return{count:d,list:c}}};var M=async(e,t)=>{let r=(Math.random()*1e7).toFixed(0);if(!(z(t)||m[320])){console.error("\u4E0D\u652F\u6301\u7684\u97F3\u8D28\u7C7B\u578B: "+t);return}let s=_("getVkey");s.req_1.param.guid=r,s.req_1.param.songmid.push(...e);let n=await p({body:JSON.stringify(s),method:"POST",type:"JSON"});try{let a=n.data?.req_1.data.sip.find(c=>!c.startsWith("http://ws"))||n.data?.req_1.data.sip[0],d={};return n.data?.req_1.data.midurlinfo.filter(c=>!!c.purl).forEach(c=>{let u=c.songmid,f=c.purl;d[u]=a+f}),d}catch(a){console.error(a)}};var N=async e=>{let t=_("getPlaylist");t.req_1.param.disstid=e;let r=await p({data:t.req_1.param,method:"GET",headers:{Referer:"https://y.qq.com/n/yqq/playlist"},type:"JSON"},"https://i.y.qq.com/qzone-music/fcg-bin/fcg_ucc_getcdinfo_byids_cp.fcg");try{if(r&&r.data.code===0)return r.data.cdlist.forEach(o=>{o.songlist=o.songlist.map(I)}),r.data.cdlist[0]}catch(o){console.error(o)}};var D=async e=>{let t=await p({data:{songmid:e,g_tk:5381,format:"json",inCharset:"utf8",outCharset:"utf-8",nobase64:1},method:"GET",type:"JSON"},"https://i.y.qq.com/lyric/fcgi-bin/fcg_query_lyric_new.fcg");try{return{lyric:h(t.data.lyric),translate:h(t.data.trans)}}catch(r){console.error(r)}};var ct={search:A,song_url:M,song_list:N,set_cookie:P,lyric:D};var mt=()=>{};var G=class{constructor(t,r,o){this.status=t;this.rawBody=r;this.data=o}},W=class{constructor(t,r,o){this.status=t;this.rawBody=r;this.data=o}};var L=class e{constructor(t,r,o={limit:e.DEFAULT_LIMIT,offset:0}){this.searchOptions=t;this.fetchFunc=r;this.position=o}static DEFAULT_LIMIT=20;limit(t){return this.position.limit=t,this}offset(t){return this.position.offset=t,this}async nextPage(){let t=await this.fetchFunc(this.searchOptions,this.position);return this.position.offset+=this.position.limit,t}};export{W as ListResponsePack,G as ResponsePack,L as SearchResult,Ue as netease,ct as qq,mt as test};
